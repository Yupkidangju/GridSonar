<!DOCTYPE html>
<html lang="ko" data-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="GridSonar — 대용량 Excel/CSV 파일 검색 도구. 서버 없이 브라우저에서 100% 독립 동작하는 PWA.">
  <meta name="theme-color" content="#0d1117">
  <meta name="color-scheme" content="dark light">

  <title>GridSonar — Smart Data Search</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🔍</text></svg>">

  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">

  <!-- [v2.6.0] Google API SDK -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js" async defer></script>

  <!-- App -->
  <script type="module" src="js/app.js"></script>
</head>

<body>
  <div id="app">
    <!-- ────── 헤더 ────── -->
    <header class="app-header">
      <div class="app-logo">
        <div class="app-logo-icon">◎</div>
        <span class="app-logo-text">GridSonar</span>
      </div>
      <div class="header-actions">
        <!-- [v1.2.1] 다국어 언어 선택 -->
        <select id="lang-select" class="lang-select" title="Language"
          style="background:transparent; border:none; color:var(--text-secondary); cursor:pointer; font-size:var(--text-sm); margin-right:8px;"></select>
        <button id="btn-help" class="btn btn--icon btn--ghost" data-i18n-title="helpTitle">?</button>
        <button id="btn-clear-cache" class="btn btn--ghost btn--sm" data-i18n-title="clearCacheTitle">
          🗑️ <span class="btn-label" data-i18n="clearCacheBtn">Flush</span>
        </button>
        <button id="btn-theme" class="btn btn--icon btn--ghost" data-i18n-title="themeToggleTitle">☀️</button>
      </div>
    </header>

    <!-- ────── 메인 ────── -->
    <main class="app-main">
      <!-- 사이드바: 파일 트리 -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <span class="sidebar-title" data-i18n="filesTitle">📁 파일</span>
          <div style="display:inline-flex; gap:4px; align-items:center;">
            <button id="btn-export-errors-sidebar" class="btn btn--ghost btn--sm" data-i18n-title="exportErrorsTitle"
              style="display:none; color:var(--danger)">⚠️</button>
            <button id="btn-add-files" class="btn btn--ghost btn--sm" data-i18n-title="addFilesTitle">＋</button>
          </div>
        </div>
        <div class="sidebar-content" id="sidebar-content">
          <div id="upload-container" class="upload-container">
            <!-- 드롭존 -->
            <div class="dropzone" id="dropzone">
              <div class="dropzone-icon">📂</div>
              <div class="dropzone-text" data-i18n="dropFilesText">파일을 여기에 끌어다 놓으세요</div>
              <div class="dropzone-formats" data-i18n="supportedFormats">.xlsx · .xls · .csv · .pdf · .docx · .pptx
              </div>
            </div>
            <!-- [v2.6.0] Google Drive 버튼 -->
            <button id="btn-google-drive" class="btn btn--drive" data-i18n-title="driveConnect">
              <svg class="drive-icon" viewBox="0 0 87.3 78" width="18" height="16">
                <path d="m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8H0c0 1.55.4 3.1 1.2 4.5z"
                  fill="#0066DA" />
                <path d="m43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3L1.2 46.7c-.8 1.4-1.2 2.95-1.2 4.5h27.5z"
                  fill="#00AC47" />
                <path
                  d="M73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5H59.85l6.1 10.6z"
                  fill="#EA4335" />
                <path d="M43.65 25 57.4 1.2C56.05.4 54.5 0 52.9 0H34.4c-1.6 0-3.15.45-4.5 1.2z" fill="#00832D" />
                <path d="M59.85 53H27.5l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.4c1.6 0 3.15-.45 4.5-1.2z"
                  fill="#2684FC" />
                <path d="M73.4 26.5 60.1 3.3c-.8-1.4-1.95-2.5-3.3-3.3L43.65 25l16.2 28h27.45c0-1.55-.4-3.1-1.2-4.5z"
                  fill="#FFBA00" />
              </svg>
              <span data-i18n="driveConnect">Google Drive</span>
            </button>
          </div>
          <!-- 파일 목록 -->
          <ul class="file-tree" id="file-tree" style="display:none;"></ul>
          <!-- [v2.1.0] 세션 히스토리 -->
          <div class="session-history" id="session-history">
            <div class="session-history-header">
              <span class="session-history-title" data-i18n="sessionHistory">📋 최근 작업</span>
            </div>
            <ul class="session-list" id="session-list"></ul>
          </div>
        </div>
      </aside>

      <!-- 리사이즈 핸들 -->
      <div class="resize-handle" id="resize-handle"></div>

      <!-- 콘텐츠 영역 -->
      <div class="content-area">
        <!-- 검색 -->
        <div class="search-area">
          <div class="search-container">
            <div class="search-input-wrapper">
              <input type="text" id="search-input" class="search-input" data-i18n-placeholder="searchPlaceholder"
                placeholder="검색어를 입력하세요... (초성 검색: ㅎㄱㄷ, 제외: -키워드, 범위: 100~500)" autocomplete="off" spellcheck="false">
              <span class="search-icon">🔍</span>
              <div class="search-stats" id="search-stats">
                <!-- 동적으로 채워짐 -->
              </div>
              <!-- 검색 기록 -->
              <div class="search-history" id="search-history"></div>
            </div>
          </div>
        </div>

        <!-- 결과 영역 -->
        <div class="results-area" id="results-area">
          <!-- 결과 도구 바 (숨겨진 상태로 시작) -->
          <div class="results-toolbar" id="results-toolbar" style="display:none;">
            <div class="results-info">
              <span id="results-count" class="results-count">0</span>
              <span data-i18n="resultsUnit">건</span>
              <span id="results-time" class="results-time"></span>
            </div>
            <div class="results-actions">
              <input type="text" id="filter-input" class="input filter-input" data-i18n-placeholder="filterPlaceholder"
                placeholder="결과 내 필터링...">
              <div class="similarity-control">
                <span data-i18n="similarityLabel">유사도</span>
                <input type="range" id="sim-slider" class="similarity-slider" min="30" max="100" value="60">
                <span id="sim-value">60%</span>
              </div>
              <!-- [v2.10.0] 행 선택 내보내기 UI -->
              <div id="selection-export-group" class="selection-export-group" style="display:none;">
                <span id="selection-count" class="selection-count">0개 선택</span>
                <button id="btn-export-selected-xlsx" class="btn btn--sm btn--accent" title="선택 행 XLSX 내보내기">✅
                  XLSX</button>
                <button id="btn-export-selected-csv" class="btn btn--sm btn--accent" title="선택 행 CSV 내보내기">✅
                  CSV</button>
                <button id="btn-clear-selection" class="btn btn--sm" title="선택 해제">✕</button>
              </div>
              <button id="btn-export-errors" class="btn btn--sm" data-i18n-title="exportErrorsTitle"
                style="display:none; border-color:var(--danger); color:var(--danger)"><span
                  data-i18n="exportErrorsBtn">⚠️ 실패 추출</span></button>
              <button id="btn-copy" class="btn btn--sm" data-i18n-title="copyTitle"><span data-i18n="copyBtn">📋
                  복사</span></button>
              <button id="btn-export-xlsx" class="btn btn--sm" data-i18n-title="exportXlsxTitle"><span
                  data-i18n="exportXlsxBtn">📤 XLSX</span></button>
              <button id="btn-export-csv" class="btn btn--sm" data-i18n-title="exportCsvTitle"><span
                  data-i18n="exportCsvBtn">📄 CSV</span></button>
            </div>
          </div>

          <!-- 결과 테이블 -->
          <div class="results-table-container" id="results-table-container" style="display:none;">
            <table class="results-table" id="results-table">
              <thead id="results-thead"></thead>
              <tbody id="results-tbody"></tbody>
            </table>
          </div>

          <!-- 빈 상태 -->
          <div class="empty-state" id="empty-state">
            <div class="empty-state-icon">◎</div>
            <div class="empty-state-title" data-i18n="emptyStateTitle">GridSonar</div>
            <div class="empty-state-text" id="empty-state-text">
              좌측에 Excel/CSV 파일을 드래그 앤 드롭하고,<br>
              검색어를 입력하면 모든 파일에서 즉시 데이터를 찾아줍니다.<br><br>
              <strong>초성 검색:</strong> ㅎㄱㄷ → 홍길동<br>
              <strong>제외 검색:</strong> 홍길동 -부산<br>
              <strong>범위 검색:</strong> 10000~50000
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- ────── 상태바 ────── -->
    <footer class="app-statusbar">
      <div class="statusbar-left">
        <span id="status-text" data-i18n="statusReady">준비됨</span>
        <div class="progress-bar" id="progress-bar" style="display:none; width:150px;">
          <div class="progress-bar-fill" id="progress-fill" style="width:0%"></div>
        </div>
      </div>
      <div class="statusbar-right">
        <span id="status-stats"></span>
      </div>
    </footer>

    <!-- ────── 토스트 컨테이너 ────── -->
    <div class="toast-container" id="toast-container"></div>

    <!-- ────── 모달 (상세 보기) ────── -->
    <div class="modal-overlay" id="detail-modal" style="display:none;">
      <div class="modal">
        <div class="modal-header">
          <span class="modal-title" id="modal-title" data-i18n="detailModalTitle">상세 보기</span>
          <button class="btn btn--ghost btn--icon" id="modal-close">✕</button>
        </div>
        <div class="modal-body" id="modal-body"></div>
      </div>
    </div>

    <!-- ────── 도움말 모달 [v2.4.0] ────── -->
    <div class="modal-overlay" id="help-modal" style="display:none;">
      <div class="modal help-modal">
        <div class="modal-header">
          <span class="modal-title" id="help-modal-title">📚 도움말</span>
          <button class="btn btn--ghost btn--icon" id="help-modal-close">✕</button>
        </div>
        <div class="modal-body" id="help-modal-body"></div>
      </div>
    </div>

    <!-- [v2.6.0] Google Drive 설정 모달 -->
    <div class="modal-overlay" id="drive-settings-modal" style="display:none;">
      <div class="modal drive-settings-modal">
        <div class="modal-header">
          <span class="modal-title">⚙ Google Drive <span data-i18n="driveSettings">설정</span></span>
          <button class="btn btn--ghost btn--icon" id="drive-settings-close">✕</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="drive-api-key">API Key</label>
            <input type="text" id="drive-api-key" class="form-input" placeholder="AIza..." autocomplete="off"
              spellcheck="false">
          </div>
          <div class="form-group">
            <label for="drive-client-id">OAuth Client ID</label>
            <input type="text" id="drive-client-id" class="form-input"
              placeholder="123456789-abc...apps.googleusercontent.com" autocomplete="off" spellcheck="false">
          </div>
          <p class="form-hint">
            <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noopener">
              📖 <span data-i18n="driveSettingsGuide">Google Cloud Console에서 생성 방법</span>
            </a>
          </p>
          <div class="form-actions">
            <button class="btn btn--ghost" id="drive-settings-cancel" data-i18n="cancel">취소</button>
            <button class="btn btn--primary" id="drive-settings-save" data-i18n="driveSave">저장 & 연결</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 숨겨진 파일 입력 -->
    <input type="file" id="file-input" multiple accept=".xlsx,.xls,.csv,.pdf,.docx,.pptx" style="display:none;">
  </div>
</body>

</html>